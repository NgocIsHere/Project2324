-- 1/ Tạo DB
IF DB_ID('PHONGKHAM_DB') IS NOT NULL
	DROP DATABASE  PHONGKHAM_DB
GO

Create Database PHONGKHAM_DB
GO
Use PHONGKHAM_DB
GO
	
-- 2/ Tạo các table + Khoá chính
-- Bảng Nhân Viên
CREATE TABLE NHANVIEN
(
	ID char(8) PRIMARY KEY,
	HOTEN nvarchar(50),
	NGAYSINH date,
	DIACHI nvarchar(200),
	SDT char(10),
	GIOITINH nvarchar(5),
	MATKHAU char(8)
)
GO
-- Bảng Nha Sĩ	
CREATE TABLE NHASI
(
	ID char(8) PRIMARY KEY,
	HOTEN nvarchar(50),
	NGAYSINH date,
	DIACHI nvarchar(200),
	SDT char(10),
	GIOITINH nvarchar(5),
	MATKHAU char(8)
)
GO

CREATE TABLE LICHLAMVIEC
(
	NHASI char(8),
	NGAY date,
	THOIGIAN TIME,
	TRANGTHAI int,
	PRIMARY KEY (NHASI,NGAY,THOIGIAN),
	FOREIGN KEY (NHASI) REFERENCES NHASI(ID)
)

-- Bảng QTV
CREATE TABLE QTV
(
	ID char(8) PRIMARY KEY,
	HOTEN nvarchar(50),
	NGAYSINH date,
	DIACHI nvarchar(200),
	SDT char(10),
	GIOITINH nvarchar(5),
	MATKHAU char(8)
)
GO

-- Bảng Bệnh Nhân
-- Bảng Bệnh Án của Bệnh Nhân
/*: Gồm thông tin cơ bản của bệnh nhân như
tên, tuổi, giới tính, tổng tiền điều trị, tổng tiền điều trị đã thanh toán,
thông tin tổng quan về sức khỏe răng miệng của bệnh nhân, ghi chú về
tình trạng dị ứng và chống chỉ định thuốc của bệnh nhân. */
CREATE TABLE BENHAN
(
	ID char(8) PRIMARY KEY,
	HOTEN nvarchar(50),
	NGAYSINH date,
	DIACHI nvarchar(200),
	SDT char(10),
	GIOITINH nvarchar(5),
	THONGTINTONGQUAN nvarchar(200),
	TINHTRANGDIUNG varchar(200),
)
GO
CREATE TABLE THUOCCHONGCHIDINH
(
	BENHNHAN char(8),
	IDTHUOC char(8),
	PRIMARY KEY(BENHNHAN,IDTHUOC),
)
/*
KEHOACHDIEUTRI(id:'BN000001,KH00001'): 
KEHOACHDIEUTRI(id:'BN000001,KH00002'):

KEHOACHDIEUTRI(id:'BN000001,KH00001'): 
MADIEUTRI NHASI   NGAY BLA  BLA
   01       X     Y   Z    K
   02       X     Y   Z    K
BENHNHAN/KEHOACHDIEUTRI(id:'BN000001,KH00002'):
MADIEUTRI NHASI   NGAY BLA  BLA
   01       X     Y   Z    K
   02       X     Y   Z    K
*/
CREATE TABLE KHDIEUTRI
(
	ID CHAR(8),
	BENHNHAN CHAR(8),
	TRANGTHAI INT,
	PRIMARY KEY(BENHNHAN,ID),
	FOREIGN KEY (BENHNHAN) REFERENCES BENHAN(ID)
)
GO
CREATE TABLE DIEUTRI
(
	MADIEUTRI int,
	BENHNHAN char(8),
	KEHOACH char(8),
	NHASI char(8),
	NGAY DATE,
	PRIMARY KEY(BENHNHAN,KEHOACH,MADIEUTRI),
	CACRANG VARCHAR(255),
	MOTA VARCHAR(255),
	GIA FLOAT,
	TRANGTHAI int,
	FOREIGN KEY (NHASI) REFERENCES NHASI(ID),
	FOREIGN KEY (BENHNHAN,KEHOACH) REFERENCES KHDIEUTRI(BENHNHAN,ID)
)
GO
CREATE TABLE THANHTOAN
(
	MADIEUTRI int,
	BENHNHAN char(8),
	KEHOACH char(8),
	PRIMARY KEY(BENHNHAN,KEHOACH,MADIEUTRI),
	LATIENMAT int,
	TIENNHAN float,
	TIENTHOI float,
	NGAYTT DATE,
	FOREIGN KEY (BENHNHAN,KEHOACH,MADIEUTRI) REFERENCES DIEUTRI(BENHNHAN,KEHOACH,MADIEUTRI) ,
)
GO
CREATE TABLE CUOCHEN
(
	ID INT,
	BENHNHAN char(8),
	NHASI char(8),
	PRIMARY KEY(ID, BENHNHAN),
	NGAYHEN date,
	GIOHEN TIME,
	GHICHU NVARCHAR(200),
	TRANGTHAI int,
	LATAIKHAM int,
	FOREIGN KEY (BENHNHAN) REFERENCES BENHAN(ID),
	FOREIGN KEY (NHASI) REFERENCES NHASI(ID)
)
GO

-----------------
CREATE TABLE THUOC (
    Thuoc_ID INT PRIMARY KEY,
    TenThuoc VARCHAR(255),
    DonGia DECIMAL(10, 2),
    DonVi VARCHAR(50)
)
GO
CREATE TABLE LOTHUOC (
    Lo_ID INT PRIMARY KEY,
    Thuoc_ID INT,
    NgayNhap DATE,
    SoLuong INT,
    TongGiaTri DECIMAL(10,2),
    NgayHetHan DATE,
    FOREIGN KEY (Thuoc_ID) REFERENCES THUOC(Thuoc_ID)
)
GO
CREATE TABLE NHACUNGCAPTHUOC (
    NCC_ID INT PRIMARY KEY,
    Ten VARCHAR(255),
    DiaChi NVARCHAR(200),
    SDT CHAR(10)
)
GO
