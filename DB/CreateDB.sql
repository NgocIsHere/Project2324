-- 1/ Tạo DB
IF DB_ID('PHONGKHAM_DB') IS NOT NULL
	DROP DATABASE  PHONGKHAM_DB
GO

Create Database PHONGKHAM_DB
GO
Use PHONGKHAM_DB
GO
	
-- 2/ Tạo các table + Khoá chính
-- Bảng Nhân Viên
CREATE TABLE NHANVIEN
(
	ID char(8) PRIMARY KEY,
	HOTEN nvarchar(50),
	NGAYSINH date,
	DIACHI nvarchar(200),
	SDT char(10),
	GIOITINH binary,
	MATKHAU char(8)
)
GO
-- Bảng Nha Sĩ	
CREATE TABLE NHASI
(
	ID char(8) PRIMARY KEY,
	HOTEN nvarchar(50),
	NGAYSINH date,
	DIACHI nvarchar(200),
	SDT char(10),
	GIOITINH binary,
	MATKHAU char(8)
)
GO

CREATE TABLE LICHLAMVIEC
(
	NHASI char(8),
	NGAY date,
	THOIGIAN float,
	TRANGTHAI binary,
	PRIMARY KEY (NGAY,THOIGIAN),
	FOREIGN KEY (NHASI) REFERENCES NHASI(ID)
)

-- Bảng QTV
CREATE TABLE QTV
(
	ID char(8) PRIMARY KEY,
	HOTEN nvarchar(50),
	NGAYSINH date,
	DIACHI nvarchar(200),
	SDT char(10),
	GIOITINH binary,
	MATKHAU char(8)
)
GO

-- Bảng Bệnh Nhân
-- Bảng Bệnh Án của Bệnh Nhân
CREATE TABLE BENHAN
(
	ID char(8) PRIMARY KEY,
	HOTEN nvarchar(50),
	NGAYSINH date,
	DIACHI nvarchar(200),
	SDT char(10),
	GIOITINH binary,
	NHASI char(8),
	THONGTINTONGQUAN nvarchar(200)
	FOREIGN KEY (NHASI) REFERENCES NHASI(ID)
)
GO
CREATE TABLE DIEUTRI
(
	MADIEUTRI char(8),
	BENHNHAN char(8),
	NHASI char(8),
	NGAY DATE,
	PRIMARY KEY(MADIEUTRI,BENHNHAN),
	MOTA VARCHAR(255),
	GIA FLOAT,
	THANHTOAN BINARY,
	NGAYTT DATE,
	FOREIGN KEY (NHASI) REFERENCES NHASI(ID),
	FOREIGN KEY (BENHNHAN) REFERENCES BENHAN(ID),
)
GO
CREATE TABLE TAIKHAM
(
	ID INT,
	BENHNHAN char(8),
	NHASI char(8),
	PRIMARY KEY(ID,BENHNHAN),
	THOIGIAN datetime,
	TRANGTHAI binary,
	FOREIGN KEY (BENHNHAN) REFERENCES BENHAN(ID),
	FOREIGN KEY (NHASI) REFERENCES NHASI(ID)
)
GO
-----------------
CREATE TABLE THUOC (
    Thuoc_ID INT PRIMARY KEY,
    TenThuoc VARCHAR(255),
    DonGia DECIMAL(10, 2),
    DonVi VARCHAR(50)
)
GO
CREATE TABLE LOTHUOC (
    Lo_ID INT PRIMARY KEY,
    Thuoc_ID INT,
    NgayNhap DATE,
    SoLuong INT,
    TongGiaTri DECIMAL(10, 2),
    NgayHetHan DATE,
    FOREIGN KEY (Thuoc_ID) REFERENCES THUOC(Thuoc_ID)
)
GO
CREATE TABLE NHACUNGCAPTHUOC (
    NCC_ID INT PRIMARY KEY,
    Ten VARCHAR(255),
    DiaChi NVARCHAR(200),
    SDT CHAR(10)
)
-- 3/ Thêm Data
-- Chèn dữ liệu cho bảng NHASI
INSERT INTO NHASI (ID, HOTEN, NGAYSINH, DIACHI, SDT, GIOITINH, MATKHAU)
VALUES
    ('NS000001', 'Nha Si 1', '1990-01-01', '123 Đường ABC, Quận XYZ', '1234567890', 1, 'pass123'),
    ('NS000002', 'Nha Si 2', '1985-05-05', '456 Đường XYZ, Quận ABC', '0987654321', 0, 'pass456');

-- Chèn dữ liệu cho bảng LICHLAMVIEC
INSERT INTO LICHLAMVIEC (NHASI, NGAY, THOIGIAN, TRANGTHAI)
VALUES
    ('NS000001', '2023-01-15', 8, 1),
    ('NS000002', '2023-01-15', 10, 0),
	('NS000001', '2023-01-15', 9, 1);
-- Chèn dữ liệu cho bảng QTV
INSERT INTO QTV (ID, HOTEN, NGAYSINH, DIACHI, SDT, GIOITINH, MATKHAU)
VALUES
    ('QTV00001', 'Quan Tri Vien 1', '1988-07-20', '789 Đường XYZ, Quận ABC', '0123456789', 1, 'qtvpass');

-- Chèn dữ liệu cho bảng BENHAN
INSERT INTO BENHAN (ID, HOTEN, NGAYSINH, DIACHI, SDT, GIOITINH, NHASI, THONGTINTONGQUAN)
VALUES
    ('BN000001', 'Nguyen Van A', '1992-03-10', '321 Đường XYZ, Quận ABC', '1112223333', 1, 'NS000001', 'Tong quan benh ly 1'),
    ('BN000002', 'Tran Thi B', '1980-12-05', '555 Đường ABC, Quận XYZ', '4445556666', 0, 'NS000001', 'Tong quan benh ly 2');

-- Chèn dữ liệu cho bảng DIEUTRI
INSERT INTO DIEUTRI (MADIEUTRI, BENHNHAN, NHASI, NGAY, MOTA, GIA, THANHTOAN, NGAYTT)
VALUES 
    ('DT000001', 'BN000001', 'NS000002', '2023-01-20', 'Dieu tri 1 cua toi', 1500000, 1, '2023-01-20'),
	('DT000002', 'BN000001', 'NS000002', '2023-01-25', 'Dieu tri 2 cua toi', 500000, 1, '2023-01-20'),
    ('DT000001', 'BN000002', 'NS000001', '2023-02-10', 'Dieu tri 1 cua toi', 2000000, 0, NULL);

-- Chèn dữ liệu cho bảng TAIKHAM
INSERT INTO TAIKHAM (ID, BENHNHAN, NHASI, THOIGIAN, TRANGTHAI)
VALUES
    (1, 'BN000001', 'NS000001', '2023-01-15 08:30:00', 1),
    (2, 'BN000002', 'NS000001', '2023-02-18 14:00:00', 0);

 